## NodeJs

- URL

>   URLæ¨¡å—æä¾›äº†ç”¨äºURLè§£æå’Œè§£æçš„å·¥å…·
>   è°ƒç”¨æ–¹å¼ï¼Œå¯ä»¥åœ¨æ¨¡å—ä¸­ä½¿ç”¨  const url = require('url');

æˆ‘ä»¬æƒ³çŸ¥é“Node.jsä¸­å†…ç½®äº†çš„æ¨¡å—æä¾›äº†å“ªäº›æ–¹æ³•ï¼Œå¯ä»¥åƒä¸‹é¢ä¸€æ ·

![url](URL-1.png)

é’ˆå¯¹æˆ‘ä»¬çš„ä¸€ä¸ªurlåœ°å€ï¼Œæœ‰å¦‚ä¸‹çš„ä¸€äº›å±æ€§
ä»¥ï¼šhttps://www.imooc.com:8080/video/6710?query=a&page=1#point-1 ä¸ºä¾‹

+ url.parse();

>   ä¼ å…¥ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œæ˜¯ä¸€ä¸ªUrlåœ°å€ï¼Œå‚æ•°äºŒæ˜¯å¯é€‰çš„ï¼ŒBool,é»˜è®¤æ˜¯false
>   
>   å‚æ•°äºŒä¸ºtrue,è¡¨ç¤ºurlåœ°å€ä¸­çš„queryå±æ€§æ€»ä¼šé€šè¿‡queryStringæ¨¡å—çš„parse()æ–¹æ³•ç”Ÿæˆä¸€ä¸ªå¯¹è±¡ã€‚é»˜è®¤ä¸ºfalse,åˆ™è¿”å›çš„ URL å¯¹è±¡ä¸Šçš„ query å±æ€§ä¼šæ˜¯ä¸€ä¸ªæœªè§£æã€æœªè§£ç çš„å­—ç¬¦ä¸² å¦‚ä¸‹å›¾url-parse-parameter2

![url-2](url-2.png)

![url-parse](url-parse-2.png)

<center><font color="green">ğŸ‘†å›¾url-parse-parameter2</font></center>

- url.format({});ä¼ å‡ºä¸€ä¸ªå¯ä»¥æ„å»ºæˆurlçš„å¯¹è±¡ï¼Œè¿”å›çš„å°±æ˜¯ä¸€ä¸ªurlé“¾æ¥åœ°å€

![url-3](url-format.png);

>   url.parse(å‚æ•°1ï¼Œå‚æ•°2ï¼Œå‚æ•°3)
>    å‚æ•°3ï¼Œå¦‚æœä¸º trueï¼Œåˆ™ // ä¹‹åè‡³ä¸‹ä¸€ä¸ª / ä¹‹å‰çš„å­—ç¬¦ä¸²ä¼šè¢«è§£æä½œä¸º hostã€‚ ä¾‹å¦‚ï¼Œ//foo/bar ä¼šè¢«è§£æä¸º {host: 'foo', pathname: '/bar'} è€Œä¸æ˜¯ {pathname: '//foo/bar'}ã€‚ é»˜è®¤ä¸º falseã€‚
>    
>    //course/lesson-1; --å‚æ•°3å¦‚æœä¸ºtrueï¼Œä¼šå°†courseè§£æä¸ºhostä¸»æœºï¼Œ"lesson-1"è§£æä¸ºpathname
>    
>    //course/lesson-1; --å‚æ•°3å¦‚æœä¸ºfalseï¼Œhostä¸»æœºåä¸ºNull,hostNameä¹Ÿä¸ºnullï¼Œä½†æ˜¯pathnameä¼šè§£ææˆ "//course/lesson-1"
>   
>   å…·ä½“éœ€è¦é‚£ç§è§£ææ–¹å¼ï¼Œçœ‹å…·ä½“éœ€æ±‚

![url-parse-parameter3](url-parse-parameter3.png);

+ url.resolve(from,to);

>   from <string\> è§£æå¼ç›¸å¯¹åŸºæœ¬çš„urlåœ°å€
>   
>   to <string\> è¦è§£æçš„è¶…é“¾æ¥url

>   url.resolve() æ–¹æ³•ä¼šä»¥ä¸€ç§ Web æµè§ˆå™¨è§£æè¶…é“¾æ¥çš„æ–¹å¼æŠŠä¸€ä¸ªç›®æ ‡ URL è§£ææˆç›¸å¯¹äºä¸€ä¸ªåŸºç¡€ URLã€‚
>   
>   <font color="red">æ³¨æ„ï¼š</font> ä»åŸºç¡€baseçš„Urlåˆ°toçš„urlï¼Œè¿™é‡Œçš„ç”¨æˆ·åå’Œå¯†ç è¿˜æ˜¯å®Œæ•´çš„

![url-resolve](url-resolve.png);


- querystring æŸ¥è¯¢å­—ç¬¦ä¸²

>   ä¸Šé¢ï¼Œæˆ‘ä»¬é€šè¿‡urlå¯ä»¥æ‹¿åˆ°æŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥ï¼Œåœ¨å¼€å‘ä¸­è‡ªç„¶å°±éœ€è¦åºåˆ—åŒ–æˆ–è€…ååºåˆ—åŒ–æŸ¥è¯¢å‚æ•°
>   
>   - querystring.escape(str)
>       + å¯¹ç»™å®šçš„ str è¿›è¡Œ URL ç¼–ç 
>       + è¯¥æ–¹æ³•æ˜¯æä¾›ç»™ querystring.stringify() ä½¿ç”¨çš„ï¼Œé€šå¸¸ä¸ç›´æ¥ä½¿ç”¨ã€‚ å®ƒä¹‹æ‰€ä»¥å¯¹å¤–å¼€æ”¾ï¼Œæ˜¯ä¸ºäº†åœ¨éœ€è¦æ—¶å¯ä»¥é€šè¿‡ç»™ querystring.escape èµ‹å€¼ä¸€ä¸ªå‡½æ•°æ¥é‡å†™ç¼–ç çš„å®ç°ã€‚
>       
>   ![query-string](querystring-esscapse.png)
>   
>   - querystring.parse(å‚æ•°1ï¼Œå‚æ•°2ï¼ˆå¯é€‰ï¼‰ï¼Œå‚æ•°3ï¼ˆå¯é€‰ï¼‰ï¼Œå‚æ•°4ï¼ˆå¯é€‰ï¼‰);ååºåˆ—åŒ–
>       +    å‚æ•°1 é‚£è‡ªç„¶æ˜¯æˆ‘ä»¬çš„æŸ¥è¯¢å­—ç¬¦ä¸²äº†
>       +    å‚æ•°2 å¯é€‰çš„ï¼Œè¡¨ç¤ºæˆ‘ä»¬æŸ¥è¯¢å­—ç¬¦ä¸²ä¸­é—´çš„key-wordæ˜¯ç”¨ä»€ä¹ˆåˆ†å‰²çš„ï¼Œé»˜è®¤æ˜¯&é“¾æ¥ (å›¾querystring-parse-parameter1)å¦‚ï¼š'query=node&keyword=nodejs&page=12' è¿™ä¸ªæŸ¥è¯¢å­—ç¬¦ä¸²ä¸­é—´å°±æ˜¯ç”¨&ä»¥ç¤ºåŒºåˆ†(querystring-parse-parameter2å›¾)
>       +   å‚æ•°3 ç”¨äºæ ‡è¯†æ¯ä¸€å¯¹æŸ¥è¯¢æ¡ä»¶çš„è¿æ¥,key-valueä¸­é—´ç”¨ä»€ä¹ˆåˆ†å‰²ï¼›ä¾‹å¦‚name:å¼ ä¸‰  è¿™é‡Œçš„å‚æ•°ä¸‰å°±æ˜¯ä¸€ä¸ª":" å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ï¼Œname="å¼ ä¸‰"
        + å‚æ•°4 åˆ¶å®šè§£æçš„é‚£ä¸ªæŸ¥è¯¢å­—ç¬¦ä¸²çš„æœ€å¤§ä¸ªæ•°ï¼Œå†™0ï¼Œå°±ä¸é™;é»˜è®¤æ˜¯1000
>      
>   ![querystring-parse](querystring-parse-1.png)
>   <center><font color="green">ğŸ‘†å›¾querystring-parse-parameter1</font></center>
>   
>   ![querystring-parse-3](querystring-parse-3.png)
>   <center><font color="green">ğŸ‘†å›¾querystring-parse-parameter2</font></center>
>   
>   å¦‚æœæŸ¥è¯¢æ¡ä»¶æ˜¯å¤åˆç±»å‹çš„ï¼Œé‚£ä¹ˆï¼Œå®ƒä¼šå°†å®ƒè§£æä¸ºä¸€ä¸ªçš„ï¼Œå°±åƒä¸‹é¢çš„è¿™ä¸ªconnectionï¼Œå…¶å®æ˜¯è¿˜æ²¡è§£æå®Œå…¨ï¼Œå› ä¸ºconnectionè§£ææˆä¸ºä¸€ä¸ªkey-wordï¼Œå®é™…è¿˜å¯ä»¥å¾€ä¸‹è§£æ
>   ![querystring-parse-2](querystring-parse-2.png)
>   
>   - querystring-stringify(å‚æ•°1ï¼Œå‚æ•°2ï¼Œå‚æ•°3ï¼Œå‚æ•°4); æŸ¥è¯¢å­—ç¬¦ä¸²åºåˆ—åŒ–ï¼Œå°†æŸ¥è¯¢å¯¹è±¡ï¼Œå˜æˆurlæŸ¥è¯¢å­—ç¬¦ä¸²

>       + å‚æ•°1ï¼šè¦åºåˆ—åŒ–çš„å­—ç¬¦ä¸²å¯¹è±¡
        + å‚æ•°2ï¼šæ˜ç¡®æŸ¥è¯¢å­—ç¬¦ä¸²å¯¹è±¡ï¼Œæ¯ä¸€ä¸ªæŸ¥è¯¢æ¡ä»¶ç”¨ä»€ä¹ˆåˆ†å‰²ï¼Œé»˜è®¤æ˜¯&
        + å‚æ•°3ï¼š ç”¨äºç¡®å®šæ¯ä¸€ä¸ªæŸ¥è¯¢æ¡ä»¶ä¸­é—´key-valueç”¨ä»€ä¹ˆåˆ†å‰²ï¼Œé»˜è®¤æ˜¯ =
        + å‚æ•°4ï¼šä¸€ä¸ªå‡½æ•°ï¼ŒæŠŠå¯¹è±¡å­—ç¬¦ä¸²åºåˆ—åŒ–æˆæŸ¥è¯¢å­—ç¬¦ä¸²ä½¿ç”¨ä»€ä¹ˆå‡½æ•°ï¼Œé»˜è®¤ä¸º querystring.secape().è¿™ä¸ªæ–¹æ³•é€šè¿‡éå†ç»™å®šçš„æŸ¥è¯¢å­—ç¬¦ä¸²obj,ç”ŸæˆurlæŸ¥è¯¢å­—ç¬¦ä¸²
  
![querystring-stringify](querystring-stringify-2.png)
   
- querystring.escape(å­—ç¬¦ä¸²); ç»™æŒ‡å®šçš„å­—ç¬¦ä¸²ç¼–ç 

![querystring-escape](querystring-escape.png)

- querystring.unescape(å­—ç¬¦ä¸²); ç»™æŒ‡å®šçš„å­—ç¬¦ä¸²è§£ç 

- è¯»å–æ–‡ä»¶

    + readFile(æ–‡ä»¶åï¼Œç¼–ç æ–¹å¼ï¼Œå›è°ƒ)
    + readFileSync(æ–‡ä»¶åï¼Œç¼–ç æ–¹å¼)
    
    ![readFile](readFile-1.png)
    ![readFile-example](readFile-example.png)

- Node.jsçš„æ ¸å¿ƒæ¨¡å—
    - å…¨å±€å¯¹è±¡å’Œå…¨å±€å˜é‡
>   jsä¸­æœ‰ä¸€ä¸ªç‰¹æ®Šçš„å¯¹è±¡ï¼Œå®ƒå’Œå®ƒæ‰€æœ‰çš„å±æ€§éƒ½èƒ½å¤Ÿåœ¨ç¨‹åºçš„ä»»ä½•åœ°æ–¹è®¿é—®ï¼Œè¿™å°±å…¨å±€å˜é‡ï¼Œè€Œè¿™ä¸ªå¯¹è±¡å°±æ˜¯å…¨å±€å˜é‡ï¼›åœ¨æµè§ˆå™¨ä¸­ï¼Œæˆ‘ä»¬è®¤ä¸ºçš„å…¨å±€å¯¹è±¡æ˜¯windowï¼Œè€Œnode.jsä¸­ï¼Œglobalæ˜¯å…¨å±€å¯¹å¯¹è±¡ï¼Œæ‰€æœ‰çš„å…¨å±€å˜é‡ï¼Œåœ¨Nodeç¯å¢ƒä¸­ï¼Œéƒ½æ˜¯globalçš„å±æ€§ã€‚

>   globalæœ€æ ¹æœ¬çš„ä½œç”¨æ˜¯ä½œä¸ºå…¨å±€å˜é‡çš„å®¿ä¸»å¯¹è±¡ã€‚æ»¡è¶³ä»¥ä¸‹æ¡ä»¶çš„å˜é‡æ˜¯å®¿ä¸»å¯¹è±¡

    + åœ¨æœ€å¤–å±‚å®šä¹‰çš„å˜é‡ -node.jsä¸å¯èƒ½åœ¨æœ€å¤–å±‚å®šä¹‰å…¨å±€å˜é‡ï¼Œå› ä¸ºæ‰€æœ‰çš„ä»£ç éƒ½å±äºå½“å‰çš„æ¨¡å—ï¼Œä»¥æ¨¡å—çš„ä¸€éƒ¨åˆ†å­˜åœ¨ï¼Œè€Œæ¨¡å—æœ¬èº«ä¸æ˜¯æœ€å¤–å±‚çš„ä¸Šä¸‹æ–‡ã€‚
    + å…¨å±€å¯¹è±¡çš„å±æ€§
    + éšå£«å®šä¹‰çš„å˜é‡ï¼ˆæœªå®šä¹‰ï¼Œç›´æ¥èµ‹å€¼çš„å˜é‡ï¼‰


    - utilå‡½æ•°å·¥å…·åº“

        + util.inherits(å­ç±»ï¼Œçˆ¶ç±»)  -- å®ç°å¯¹è±¡é—´åŸå‹é›†æˆçš„å‡½æ•°

>   nodeä¸­çš„å·¥å…·å‡½æ•°utilinheritsçš„ç»§æ‰¿æ–¹å¼ï¼Œå­ç±»ä¸ä¼šç»§æ‰¿æ„é€ å‡½æ•°ä¸­çš„å±æ€§å’Œæ–¹æ³•ï¼Œåªä¼šç»§æ‰¿åŸå‹ä¸Šçš„å±æ€§å’Œæ–¹æ³•ï¼›è€Œconsole.log()æ‰“å°çˆ¶ç±»æ—¶ï¼Œä¹Ÿä¸ä¼šå°†åŸå‹ä¸­çš„å†…å®¹ï¼ˆå±æ€§ï¼Œæ–¹æ³•ï¼‰æ‰“å°å‡ºæ¥

![uti.inherits](util.inherits.png); 

ç»“æœ

![util-inherits-result](util-inherits-2.png);
        
    + util.inspect(å¯¹è±¡[,æ˜¯å¦æ˜¾ç¤ºè¯¦æƒ…[,æ˜¾ç¤ºæ·±åº¦],[åœ¨ç»ˆç«¯æ˜¾ç¤ºçš„é¢œè‰²]])

>   å°†ä¸€ä¸ªå¯¹è±¡ï¼Œè½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œè¿™é‡Œè½¬æ¢ï¼Œå’Œç›´æ¥è°ƒç”¨å­—ç¬¦ä¸²çš„toStringï¼ˆï¼‰æ–¹æ³•ä¸åŒï¼Œå³ä½¿ä½ åœ¨å¯¹è±¡ä¸­å®šä¹‰äº†toStringï¼ˆï¼‰æ–¹æ³•ï¼Œä¹Ÿä¸ä¼šè°ƒç”¨(éœ€è¦çœ‹çœ‹å®˜ç½‘)

![uti.inspect](util.inspect.png)

-----
# nodeå†…éƒ¨æœºåˆ¶

## æ¨¡å—åŠ è½½æœºåˆ¶

>   node.jsé€šè¿‡requireï¼ˆ"æ¨¡å—å"ï¼‰æ¥åŠ è½½æ¨¡å—

- æ¨¡å—çš„ç±»å‹ï¼ˆåˆ†ç±»ï¼‰

>   æ ¸å¿ƒæ¨¡å—å’Œæ–‡ä»¶æ¨¡å—ã€‚æ ¸å¿ƒæ¨¡å—æ˜¯node.jså®˜ç½‘æä¾›çš„APIï¼Œä¾‹å¦‚fs,http,net,vmç­‰ï¼Œè¿™éƒ½æ˜¯ç”±å®˜ç½‘æä¾›çš„ï¼Œå·²ç»ç¼–è¯‘æˆäºŒè¿›åˆ¶çš„ã€‚å½“è·å–æ¨¡å—é‡åˆ°ä¸æ ¸å¿ƒæ¨¡å—é‡åçš„æƒ…å†µï¼Œnode.jsä¼šä¼˜å…ˆåŠ è½½æ ¸å¿ƒæ¨¡å—

>   æ–‡ä»¶æ¨¡å—æ˜¯åˆ™æ˜¯å­˜å‚¨ä¸ºå•ç‹¬çš„æ–‡ä»¶ï¼ˆæˆ–æ–‡ä»¶å¤¹ï¼‰çš„æ¨¡å—ï¼Œå¯èƒ½æ˜¯javascriptä»£ç ï¼ŒJSONæˆ–è€…ç¼–è¯‘å¥½çš„c/c++ä»£ç ã€‚åœ¨åŠ è½½æ¨¡å—çš„æ—¶å€™æˆ‘ä»¬å¤§éƒ¨åˆ†æ²¡æœ‰æ·»åŠ åç¼€åï¼Œé»˜è®¤çš„åŠ è½½é¡ºåºæ˜¯ï¼š .js>.json>.node(c/c++ç¼–è¯‘å¥½çš„æ–‡ä»¶)

- æŒ‰è·¯å¾„åŠ è½½æ¨¡å—

>   æ–‡ä»¶æ¨¡å—çš„åŠ è½½æ–¹å¼æœ‰2ç§ï¼ŒæŒ‰è·¯å¾„åŠ è½½å’ŒæŸ¥æ‰¾node_modulewæ–‡ä»¶å¤¹

>   å¦‚æœä»¥"/"å¼€å¤´ï¼Œå°±æ˜¯ä»¥ç»å¯¹è·¯å¾„æŸ¥æ‰¾ï¼Œä¾‹å¦‚ï¼š'/home/book/module'

>   æŒ‰ç…§ä¸Šé¢è¯´çš„ï¼Œä¼˜å…ˆåŠ è½½'/home/book/module.js',å†æ˜¯'/home/book/module.json',æœ€å'/home/book/module.node'

>   å¦‚æœæ˜¯"./"æˆ–"../"ç­‰çš„å½¢å¼åŠ è½½,é‚£ä¹ˆä»¥ç›¸å¯¹è·¯å¾„åŠ è½½æ¨¡å—ã€‚

- é€šè¿‡æŸ¥æ‰¾node_modulemç›®å½•åŠ è½½æ¨¡å—

>   å¦‚æœrequireåŠ è½½çš„æ¨¡å—æ—¢ä¸æ˜¯æ ¸å¿ƒæ¨¡å—ï¼Œä¹Ÿä¸æ˜¯'/',"./","../"è¿™ç§æŒ‰ç…§è·¯å¾„åŠ è½½çš„ï¼Œé‚£ä¹ˆå®ƒçš„æŸ¥æ‰¾é¡ºåºå°±æ˜¯å»æ‰¾node_moduleç›®å½•ï¼Œå»æ‰¾å¯¹åº”çš„æ¨¡å—

>   ä¾‹å¦‚ï¼š åœ¨require("/home/book/foo.js");è°ƒç”¨require("bar.js")æ¨¡å—ï¼Œå°±ä¼šä¾æ¬¡æŸ¥æ‰¾ 

>   /home/book/node_module/bar.js

>   /home/node_module/bar.js

>   /node_module/bar.js

><font color="red">æ³¨ï¼š</font>è¿™æ ·çš„åŸå› æ˜¯ï¼Œé€šå¸¸ä¸€ä¸ªå·¥ç¨‹ä¸­ï¼Œæœ‰å¾ˆå¤šç›®å½•ï¼Œå½“å­ç›®å½•éœ€è¦è°ƒç”¨å·¥ç¨‹çš„å…¬å…±æ¨¡å—ï¼Œå°±éœ€è¦å‘ä¸Šå›æº¯ï¼Œä¸€å±‚ä¸€å±‚çš„å»æ‰¾ã€‚

- åŠ è½½æœºåˆ¶

>   node.jsçš„æ¨¡å—ä¸ä¼šè¢«é‡å¤åŠ è½½ï¼Œå®ƒä¼šæ ¹æ®å®é™…æƒ…å†µï¼Œè¿›è¡Œæ–‡ä»¶åçš„ç¼“å­˜ï¼Œåªè¦ä½ 2æ¬¡æˆ–å¤šæ¬¡åŠ è½½çš„æ¨¡å—ï¼ŒæŒ‡å‘åŒä¸€ä¸ªæ–‡ä»¶ï¼ŒNodeåªä¼šåŠ è½½ä¸€æ¬¡ã€‚


# äº‹ä»¶é©±åŠ¨

>   ä¸ºäº†æŸä¸ªäº‹ä»¶æ³¨å†Œäº†å›è°ƒå‡½æ•°ï¼Œè¿™ä¸ªcallbackä¸æ˜¯é©¬ä¸Šæ‰§è¡Œï¼Œè€Œæ˜¯ç­‰åˆ°äº‹ä»¶è§¦å‘æ‰æ‰§è¡Œï¼Œåƒè¿™ç§ï¼Œå°±æ˜¯äº‹ä»¶é©±åŠ¨
